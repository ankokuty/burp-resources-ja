<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../../../../styles/css/ps.css">
</head>
<body>
<section class="container ps-breadcrumbs">
    <ol>
        <li>
            <a href="https://support.portswigger.net/">サポートセンター</a>
        </li>
        <li>
            <a href="../../../index.html">ドキュメント</a>
        </li>
        <li>
            <a href="../../index.html">デスクトップ版</a>
        </li>
        <li>
            <a href="../index.html">オプション</a>
        </li>
        <li>
            <a href="index.html">セッション</a>
        </li>
        <li>
            <a href="rule-editor.html">ルールエディタ</a>
        </li>
    </ol>
</section>
<section class="container edition-labels">
	<span class="pro-edition-feature-label">プロフェッショナル</span>&nbsp;<span class="pro-edition-feature-label">コミュニティ</span>
</section>
<section class="maincontainer">
    <div class="container main">
        <h1>オプション: セッションハンドリングルールエディタ</h1>
        <p>
            セッションハンドリングエディタでは、<a href="index.html#session-handling-rules">セッションハンドリングルール</a>全ての詳細を設定できます。
        </p>
        <h2 id="rule-description">ルール詳細</h2>
        <p>
            これは、ルールの詳細を記載するフリーフォームのテキストフィールドです。説明は、設定されたルールの順序通り一覧に表示されます。
        </p>
        <h2 id="rule-actions">ルールアクション</h2>
        <p>
            各ルールは、実行される1つまたは複数のアクションが指定できます。ルールが適用されると、次のアクションを適用しないよう設定されたアクションがない限り、これらのアクションが順番に実行されます。
        </p>
        <div class="rounded-corner-box">
            <p>
                次の種類のアクションがあります:
            </p>
            <ul class="link-list">
                <li>
                    <a href="#use-cookies-from-the-session-handling-cookie-jar">セッションハンドリングcookie jarのcookieを使用する</a>
                </li>
                <li>
                    <a href="#set-a-specific-cookie-or-parameter-value">指定したcookieやパラメータ値をセットする</a>
                </li>
                <li>
                    <a href="#check-session-is-valid">セッションの有効性をチェックし、結果によってサブアクションを実行</a>
                </li>
                <li>
                    <a href="#prompt-for-in-browser-session-recovery">ブラウザ内セッション復元のプロンプトを出す</a>
                </li>
                <li>
                    <a href="#run-a-macro">マクロを実行する</a>
                </li>
                <li>
                    <a href="#run-a-post-request-macro">リクエスト後マクロを実行する(現在のリクエストが発行され、さらにマクロを実行する)</a>
                </li>
                <li>
                    <a href="#invoke-a-burp-extension">Burp拡張を呼び出す</a>
                </li>
            </ul>
        </div>
        <p>
            これらのアクションは全て詳細に設定可能で、任意の方法で組み合わせると、ほぼ全てのセッションハンドリングメカニズムを処理できます。例えば、任意のマクロ(一連の定義済みリクエスト)を実行し、その結果に基づいて指定されたcookieとパラメータ値を更新できるため、自動スキャンやIntruderの攻撃でアプリケーションに自動的に再ログインができます。ブラウザー内のセッション復元のプロンプトで、物理トークンからの番号キー入力やCAPTCHA形式のパズル回答などのログインメカニズムでも動作します。
        </p>
        <h3 id="use-cookies-from-the-session-handling-cookie-jar">セッションハンドリングcookie jarのcookieを使用する</h3>
        <p>
            このアクションは、Burpの<a href="index.html#cookie-jar">cookie jar</a>の関連するcookieで、リクエストを更新します。全てのcookie(または一部除外)、または特定のcookieだけを更新するようアクションの設定ができます。
        </p>
        <h3 id="set-a-specific-cookie-or-parameter-value">特定cookieまたはパラメータ値の指定</h3>
        <p>
            このアクションは、名前付きのパラメータやcookieに、指定した値をセットしてリクエストを更新します。存在していない場合、追加するパラメータのタイプを指定できます。
        </p>
        <h3 id="check-session-is-valid">セッションの有効性のチェックする</h3>
        <p>
            このアクションは、現在のセッションが有効かどうかをチェックし、有効でない場合は有効な新しいセッションを取得するアクションを実行します。
        </p>
        <h4>セッションを検証するリクエスト発行</h4>
        <p>
            Burpは、1つ以上のリクエストを発行して、現在のセッションの有効性を判断します。次のいずれかです:
        </p>
        <ul>
            <li>
                ルールに処理される現在のリクエストを発行する。
            </li>
            <li>
                <a href="index.html#macros">マクロ</a>を実行する。
            </li>
        </ul>
        <p>
            現在のリクエストが発行され、セッションが有効だとルールが判断した場合、このリクエストでさらにアクションは実行されません。
        </p>
        <p>
            Xリクエストごとに、Burpがセッションを検証する設定もできます。アプリケーションがほとんどセッションを無効にしない場合、余計なリクエストを発生させないために便利です。&nbsp;
        </p>
        <h4>セッションの有効性判断にレスポンスを検証</h4>
        <p>
            設定されたリクエストを作成後、Burpはレスポンスを調べてセッションの有効性を判断します。マクロが実行された場合、Burpはマクロ内最後のリクエストのレスポンスを調べます。
        </p>
        <p>
            セッションが有効性か判断するために、指定した文字列がレスポンスに含まれているかどうかをチェックします。Burpが検索する対象は次の通りです:
        </p>
        <ul>
            <li>
                HTTPレスポンスヘッダ
            </li>
            <li>
                レスポンスボディ
            </li>
            <li>
                リダイレクト対象のURL
            </li>
        </ul>
        <p>
            検索にリテラル文字列または正規表現を使用するかどうか、また大文字小文字を区別するかどうかを設定できます。
        </p>
        <h4>セッション有効性に応じた動作の定義</h4>
        <p>
            セッションの有効性に応じて、Burpの動作を設定できます。
        </p>
        <p>
            セッションが有効な場合、Burpが現在のリクエストにさらにルールやアクションを処理しないよう指定できます。Burpが現在のリクエストを発行してセッションを検証するように設定されている場合、このオプションは必須です。
        </p>
        <p>
            セッションが無効な場合、新しい有効なセッションを取得するために、Burpが次のいずれかのアクションを実行するように指定できます:
        </p>
        <ul>
            <li>
                <a href="#run-a-macro">マクロを実行する</a>
            </li>
            <li>
                <a href="#prompt-for-in-browser-session-recovery">ブラウザ内セッション復元のプロンプトを出す</a>
            </li>
        </ul>
        <h3 id="prompt-for-in-browser-session-recovery">ブラウザ内セッション復元のプロンプトを出す</h3>
        <p>
            ブラウザを使用して有効なセッションを復元するようBurpにプロンプトを出させます。同じBurpのインスタンスをプロキシとして使用するようブラウザを設定している必要があり、これによりBurpがブラウザのリクエストや新しいcookieが発行されたことを監視できるようになります。
        </p>
        <p>
            アプリケーションによってセットされたcookieはBurpのセッションハンドリングcookie jarに追加され、設定により現在のリクエストを更新できます。全てのcookie(または一部除外)、または特定のcookieだけを更新するようアクションの設定ができます。
        </p>
        <h3 id="run-a-macro">マクロを実行する</h3>
        <p>
            このアクションは、マクロ(一連の定義済みリクエスト)を実行します。マクロは、Burpのセッション設定内で<a href="index.html#macros">別々に定義</a>され、セッションハンドリングルールで利用できます。
        </p>
        <p>
            マクロの実行後、マクロの最終レスポンスに基づき、現在処理されているリクエストのパラメータやcookieを更新できます。
        </p>
        <p>
            マクロの最終レスポンスで得られる値を使用して、現在のリクエストのパラメータを更新できます。パラメータ値の変更は一般的に<a href="macro-editor.html#parameter-handling">マクロパラメータ</a>と同じように動作します。変更パラメータで、次のオプションを使用できます:
        </p>
        <ul>
            <li>
                マッチしたパラメータ値をURLエンコードする。このオプションは、ほとんどのタイプのリクエストパラメータに必要です。
            </li>
            <li>
                パラメータマッチ時にURLの不一致を許容する。通常、過去のレスポンスからパラメータを変更させる場合、レスポンスから推測されるパラメータ名とURLの両方を、後続のリクエストのパラメータ名とURLに一致させる必要があります。このオプションを使用すると、BurpにURLの不一致を許容するよう指示します。このオプションは、アプリケーションがURLに依存しない、つまりアプリケーションのある場所で取得して別の場所で再利用できる、CSRFトークンを使用する場合に便利です。このオプションを使用すると、CSRFトークンパラメータを含むリクエストが実行されるルールを定義し、固定の場所から新しいトークンを取得する単一のマクロを実行することで、必要なセッションハンドリングルールを大幅に簡素化できます。
            </li>
        </ul>
        <p>
            マクロから変更したパラメータとcookie両方に対して、現在のリクエストの全てのアイテム(または一部除外)、または特定のアイテムのみ更新するようアクションの設定ができます。
        </p>
        <h3 id="run-a-post-request-macro">リクエスト後マクロを実行する</h3>
        <p>
            このアクションは、現在処理中のリクエストが発行され、さらにマクロ(一連のリクエスト)が実行されます。マクロは、Burpのセッション設定内で<a href="index.html#macros">別々に定義</a>され、セッションハンドリングルールで利用できます。このアクションが実行された後、現在処理されているリクエストに対して、それ以上のルールやアクションは実行されません。
        </p>
        <p>
            テストするリクエストが多段階プロセスの処理内に存在し、残りの手順を実行してアプリケーションの状態を更新し対象リクエストの影響を判断する必要がある場合に、リクエスト後マクロが便利です。
        </p>
        <p>
            現在のリクエストを発行後、最初のマクロリクエストのパラメータを、現在のリクエストのレスポンスに基づいて更新ができます。パラメータ値の変更は一般的に<a href="macro-editor.html#parameter-handling">マクロパラメータ</a>と同じように動作します。最初のマクロリクエストの全てのパラメータ(または一部除外)、または特定のパラメータのみ更新するようアクションの設定ができます。
        </p>
        <p>
            起動しているツールに、マクロを実行する前にに発行されている現在のリクエストのレスポンスを渡すか、マクロの最終レスポンスを渡すか、アクションの設定ができます。後者は、多段階プロセスのある手順をスキャンやファジングした結果、その処理のエラーメッセージが後の手順で表示される場合に便利です。
        </p>
        <h3 id="invoke-a-burp-extension">Burp拡張を呼び出す</h3>
        <p>
            <a href="../../tools/extender.html">Burp拡張</a>を呼び出し現在のリクエストを処理します。拡張はセッションハンドリングアクションハンドラーを登録している必要があります。現在読み込まれている拡張のうち使用可能なハンドラーのリストから、必要なハンドラーを選択できます。
        </p>
        <h2 id="tools-scope">ツールスコープ</h2>
        <p>
            各ルールをどのBurpツールに適用するか指定できます。このツールスコープに含まれるツールによって発行されたリクエストでのみ、ルールは処理されます。
        </p>
        <h2 id="url-scope">URLスコープ</h2>
        <p>
            各ルールを適用するURLを指定できます。全てのURLを含める(Burpのcookie jarを利用する一般的なルールで便利)か、Suite全体の<a href="../../tools/target/scope.html">ターゲットスコープ</a>を利用する(現在のセッションを検証するなどアプリケーション範囲のルールで便利)か、カスタムスコープを指定(単一のリクエストにのみ影響を与えるルールで便利)かを設定できます。
        </p>
        <p>
            詳細は、<a href="../../functions/url-matching.html">URLスコープの設定</a>を参照してください。
        </p>
        <h2 id="parameter-scope">パラメータスコープ</h2>
        <p>
            特定の名前のパラメータを含むリクエストだけにルールを適用するよう指定もできます。例えばCSRFトークンのような、更新が必要なパラメータを含むすべてのリクエストに影響を与える、アプリケーション全体のルールで便利です。
        </p>
    </div>
</section>
</body>
</html>