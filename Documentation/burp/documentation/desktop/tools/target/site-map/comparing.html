<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../../../../../styles/css/ps.css">
</head>
<body>
<section class="container ps-breadcrumbs">
    <ol>
        <li>
            <a href="https://support.portswigger.net/">サポートセンター</a>
        </li>
        <li>
            <a href="../../../../index.html">ドキュメント</a>
        </li>
        <li>
            <a href="../../../index.html">デスクトップ版</a>
        </li>
        <li>
            <a href="../../index.html">ツール</a>
        </li>
        <li>
            <a href="../index.html">Target</a>
        </li>
        <li>
            <a href="index.html">対象サイトマップ</a>
        </li>
        <li>
            <a href="comparing.html">サイトマップの比較</a>
        </li>
    </ol>
</section>
<section class="container edition-labels">
	<span class="pro-edition-feature-label">プロフェッショナル</span>&nbsp;<span class="pro-edition-feature-label">コミュニティ</span>
</section>
<section class="maincontainer">
    <div class="container main">
        <h1>サイトマップの比較</h1>
<p>
            この機能により、2つのサイトマップを比較し、差異を強調表示できます。この機能は、アクセス制御系の脆弱性を見つける様々な方法や、大規模なアプリケーションのうちどの部分を手動検査すれば良いかの確認に使えます。この機能の典型的な使用例は次の通りです:
        </p>
        <ul>
            <li>
                異なる権限のアカウントを使用してアプリケーションをマッピングし比較すると、一方のユーザーだけに表示される機能が確認できます。
            </li>
            <li>
                高い権限を持つアカウントを使用してアプリケーションをマッピングし、低い権限のアカウントを使用してサイト全体を再度リクエストすると、特権機能へのアクセスが適切に制御されているかどうか確認できます。
            </li>
            <li>
                同じタイプの２つの異なるアカウントを使用してアプリケーションをマッピングすると、機密性の高いリソースへアクセスする際どこでユーザー固有のIDが使われているか特定でき、ユーザー毎のデータが適切に分離されているかどうか判断できます。
            </li>
        </ul>
        <p>
            メイン<a href="index.html">サイトマップ</a>のコンテキストメニューの"サイトマップ比較"で、この機能にアクセスできます。比較<a href="#site-map-sources">元</a>のサイトマップ、そのサイトマップとどのようなリクエストを<a href="#request-matching">マッチ</a>させるのか、どのような<a href="#response-comparison">レスポンスの比較</a>をする必要があるのかを、設定するウィザードが開きます。Burpは比較を実行し、レビュー用に<a href="#comparison-results">結果</a>を表示します。
        </p>
        <h2 id="site-map-sources">サイトマップソース</h2>
        <p>
            サイトマップを比較するには、比較する元サイトマップを選択する必要があります。次のオプションがあります:
        </p>
        <ul>
            <li>
                BurpのTargetタブに表示されている現在のサイトマップ
            </li>
            <li>
                <span class="pro-edition-feature-label">プロフェッショナル</span> 以前保存したBurpのプロジェクトファイルやステートファイルから読み込むサイトマップ。このオプションは、異なる権限レベルを持つアカウントを使用したアプリケーションマップが既にある場合に便利です。
            </li>
            <li>
                上記のいずれかと別のセッションコンテキストで再リクエスト。このオプションは、高い権限のアカウントでアプリケーションのマッピングをしている場合で、低い権限のアカウントを使って再リクエストし特権の機能へのアクセスが適切に制御されているかどうか確認したい場合に便利です。
            </li>
        </ul>
        <p>
            サイトマップの全てのコンテンツを含めるか、スコープ内のアイテムだけに制限するか、選択ができます。
        </p>
        <p>
            別のセッションコンテキストでサイトマップを再リクエストする場合、次の点に注意してください:
        </p>
        <ul>
            <li>
                まず、比較時に作られるリクエストが目的のセッションコンテキスト内で行われるように、適切な<a href="../../../options/sessions/index.html#session-handling-rules">セッションハンドリングルール</a>を作成する必要があります。これらのルールは、<a href="../index.html">Target</a>ツールで作られたリクエストに適用されるように校正する必要があります。最も単純なケースでは、<a href="../index.html">Target</a>ツールのリクエストのcookieを、Burpの<a href="../../../options/sessions/index.html#cookie-jar">cookie jar</a>で更新するセッションハンドリングルールを使い、比較を実行する前に目的のセッションコンテキストをブラウザで取得すればよいでしょう。他のケースでは、現在のセッションを検証して必要に応じて再ログインするなど、より複雑なセッションハンドリングルールを作成する必要があります - 詳細は<a href="../../../options/sessions/index.html">セッションハンドリングルールのヘルプ</a>を参照してください。
            </li>
            <li>
                一般的に、セッションコンテキストを混乱させる可能性のあるリクエストの除外が望ましいです  - 例えばログイン、ログアウト、ユーザー偽装機能などです。選択済みまたはスコープ内のアイテムのみに比較を制限するオプションを使用すれば可能です。
            </li>
        </ul>
        <h2 id="request-matching">リクエストマッチ</h2>
        <p>
            比較を実行するため、Burpは１つ目のサイトマップの各リクエストごとに、２つめのサイトマップのリクエストと対応付け、逆も同様に行います。対象アプリケーションの機能に合わせて、どのようにリクエストの対応付けするか、詳細な設定が可能です。
        </p>
        <p>
            リクエストの対応付けに次のどのアイテムを使用するか選択できます:
        </p>
        <ul>
            <li>
                <strong>URLファイルパス</strong> - これは常に対応付けプロセスに含める必要があり、２つのリクエストが同等であることを確認するための最低限の基準です。
            </li>
            <li>
                <strong>HTTPメソッド</strong> - 一般的にこれを含むべきで、ほとんどのアプリケーションは、同じURLでもGETとPOSTメソッドで異なる挙動をします。
            </li>
            <li>
                <strong>URLクエリーストリング</strong> - 一般的にこれを含むべきで、異なるURLパラメーターは異なるアプリケーションの機能で使われます。<strong>パラメーター名のみ一致</strong>サブオプションは、同じパラメーター名で値が異なるクエリーストリングでも対応付けします。これは、(例えばパラメーター値にユーザー固有または一時的なデータが含まれている場合など)望ましい場合がありますが、実行されるアプリケーション機能の特定にパラメーターが使われている(例えばaction=CreateUserなど)場合は、無効にすべきです。<strong>これらのパラメーターを無視する</strong>サブオプションは、対応付けの際、完全に無視するクエリーストリングのパラメーターを指定できます。
            </li>
            <li>
                <strong>リクエストボディ</strong> - 一般的にこれを含むべきで、異なるボディパラメーターは異なるアプリケーションの機能で使われます。URLクエリストリングパラメーターの説明と同じオプションがあります。
            </li>
            <li>
                <strong>リクエストヘッダー</strong> - このオプションは、リクエストの先頭行の後の、HTTPヘッダーが異なるリクエストに影響があります。アプリケーションレベルの機能では使われないのに、ブラウザが様々理由でリクエストごとにヘッダーを変更する可能性があるため、この動作は通常望ましくありません。ただし例えば、スクリプトが生成したカスタムHTTPヘッダーを含むリクエストをアプリケーションが利用していて、それがリクエストする機能の特定に使われている場合、このオプションを有効にしてもよいです。
            </li>
        </ul>
        <p>
            デフォルトオプションでほとんどの状況で問題なく、URLファイルパス、HTTPメソッド、クエリーストリングとメッセージボディのパラメーター名によって、対応付けを行います。
        </p>
        <h2 id="response-comparison">レスポンス比較</h2>
        <p>
            リクエストを対応付けるため、レスポンスを比較し違いを特定します。対象アプリケーションの機能に合わせて、レスポンスの比較方法の詳細を設定できます。
        </p>
        <p>
            次のオプションがあります:
        </p>
        <ul>
            <li>
                <strong>レスポンスヘッダー</strong> - 全てのヘッダー(指定した一部を除く)を含めるか、指定したヘッダーだけを含めるか、選択できます。アプリケーションの機能や状態が値に反映されるヘッダー(Set-Cookieなど)を含めることが一般的に望ましいです。
            </li>
            <li>
                <strong>フォームフィールド値</strong> - 全てのフォームフィールド値(指定した一部を除く)を含めるか、指定した値だけを含めるか、選択できます。一般的に、アクセス制御の問題を確認する際、フォームフィールド値に差異が現れる場合が多く、手動レビューで注目する必要があります。この設定を変更して、無関係なフィールドを除外し、比較を繰り返せます。
            </li>
            <li>
                <strong>空白</strong> - 空白のみのレスポンスは、一般的にアクセス制御の問題に関係しないため、無視もできます。
            </li>
            <li>
                <strong>MIMEタイプ</strong> - テキスト以外のコンテンツの比較を省略できます。これらのレスポンスにはイメージなどの静的コンテンツが含まれていることが多く、アクセス制御の問題に関係しないため、このような比較は計算集約的に望ましい方法です。
            </li>
        </ul>
        <p>
            デフォルトのオプションで、ほとんどの状況で機能します。この設定では、一般的なHTTPヘッダーや一時的な値を持つフォームフィールドを無視し、空白のみのレスポンスも無視します。デフォルトのオプションは、レスポンス内の細かい変化によるノイズを減らすように設計されており、問題の可能性が高い差異の方に集中できます。
        </p>
        <h2 id="comparison-results">比較結果</h2>
        <p>
            比較結果には、両方のサイトマップがツリービューとテーブルビュー表示され、関連する差異が強調表示されます。2つのサイトマップ間で追加、削除、または変更されたアイテムは、それに応じて色分けされます。テーブルビューには"差異箇所数"列もあり、マップ1のレスポンスをマップ2のレスポンスに一致させるために編集が必要なテキスト数の最小値を表しています。
        </p>
        <p>
            マップやツリーで1つ以上のアイテムを選択すると、他方のマップでも同じツリーのブランチが表示されるよう選択が自動的に更新され、またはテーブル内の同じアイテムが選択されます。"選択を同期"オプションをオフにするとこの動作を変更できます。
        </p>
        <p>
            選択したアイテムの完全なリクエストとレスポンスがリクエスト/レスポンスビューアに表示され、関連する差異がレスポンス内で強調表示されます。
        </p>
        <p>
            1つの<a href="index.html#site-map-display-filter">ディスプレイフィルター</a>が両方のサイトマップに適用され、デフォルトでは全てのアイテムが表示されています。
        </p>
        <p>
            サイトマップ比較の結果を解釈するには、人間の知能、及び指定されたアプリケーション機能の意味とコンテキストを理解する必要があります。例:
        </p>
        <ul>
            <li>
                レスポンスの一部の差異はセキュリティと関係ありません。例えば、異なる2人のアプリケーションのホームページには、異なる表示名、リンク、ユーザー固有のコンテンツが含まれる場合があります。これらの差異は予想通りで、ユーザーインターフェイスのみに関連するためアプリケーションのアクセス制御の有効性には関係ありません。
            </li>
            <li>
                一部の差異は、アクセス制御が設計通りに機能していることを示しています。例えば、管理者ユーザーは特権機能にアクセスでき、低権限ユーザーには"許可されていません"というメッセージが表示されます。
            </li>
            <li>
                同じレスポンスが2人のユーザーに返された場合、セキュリティの問題を表しています。例えば、管理者ページにアプリケーションユーザーに関する機密情報を含むページへのリンクがあり、低権限ユーザーも同じページを表示できる場合などです。
            </li>
            <li>
                他のケースでは、同じレスポンスが2人のユーザーに返ってもセキュリティ的に問題ありません。例えば、アプリケーションの公開検索機能は、ユーザーのコンテキストに関係なく同じ結果を返すように設計されているでしょう。
            </li>
            <li>
                場合によっては、ユーザーごとのUIカスタマイズ(異なる表示名やリンクなど)による差異が多くのページに存在し、アクセス制御の評価に関連する他のページでも同じ部分と異なる部分があります。
            </li>
        </ul>
        <p>
            全てのこれらのシナリオは同じアプリケーションで共存するため、実際のアクセス制御の問題を特定する作業が困難になります。これを行う唯一の方法は、比較結果を手動でレビューすることです。Burpには、このプロセスを簡単にするためのいくつかの方法があります:
        </p>
        <ul>
            <li>
                <a href="index.html#site-map-display-filter">ディスプレイフィルター</a>を利用して、指定した文字列を含む(または含まない)アイテムを除外できます。例えば、ほとんど管理者機能が、低権限のユーザーのリクエストに"許可されていません"というメッセージを返す場合、これらのレスポンスをマップで非表示にし、アプリケーションの特権モデルに問題のあるアイテムのみを残せます。
            </li>
            <li>
                テーブルビューの"差異箇所数"列は、手がかりに便利です。例えば、アプリケーションのほとんどのページに、ユーザーごとのUIカスタマイズによる差異が2つある場合、差異箇所数でレスポンスをソートしすると、この値から逸脱したレスポンスを探せます。また、特定の差異箇所数でアクセス制御の脆弱性を1つ見つけた場合、同じまたは似た数の他のレスポンスは同様に脆弱な機能かもしれません。
            </li>
            <li>
                比較結果を確認していて、レスポンスヘッダーやフォームフィールド値に関連性のない規則的な差異があると判断した場合は、比較対象から除外するべきです。クエリーストリングやボディパラメーターに基づくマッチが、一部のリクエストで正しくないことがあります。この場合、<a href="#response-comparison">レスポンス比較</a>または<a href="#request-matching">リクエストマッチ</a>オプションに戻り微調整し、比較を再実行してください(これらのオプションを変更した際は、サイトマップを再リクエストする必要はありません)。
            </li>
        </ul>
        <p>
            このような複雑なアクセス制御の評価を行う理由は、全自動ツールではアクセス制御の脆弱性をほとんど特定できないためです。実際には、その目的のツールのほとんどがノイズを生成し、誤検出や検知漏れになりがちです。アプリケーションの機能を詳細に調査し、それぞれの場合にアクセス制御が適切に実装されているかどうか評価するタスクを、Burpがすべて行ってくれるわけではありません。サイトマップ比較機能は、できるだけ多くの処理を自動化し、必要な全ての情報を明確な形式で提供し、アプリケーションの機能の知識を活用して実際の脆弱性を特定できるようにします。
        </p>
    </div>
</section>
</body>
</html>